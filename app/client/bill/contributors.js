
contributors = {
  "dianne_feinstein": [
    {
      "contributor": "PG&E Corp",
      "total": "$111,200",
      "indivs": "$108,050",
      "pacs": "$3,150"
    },
    {
      "contributor": "JStreetPAC",
      "total": "$82,171",
      "indivs": "$75,525",
      "pacs": "$6,646"
    },
    {
      "contributor": "General Atomics",
      "total": "$56,750",
      "indivs": "$46,750",
      "pacs": "$10,000"
    },
    {
      "contributor": "Edison International",
      "total": "$51,850",
      "indivs": "$44,250",
      "pacs": "$7,600"
    },
    {
      "contributor": "General Dynamics",
      "total": "$45,500",
      "indivs": "$33,500",
      "pacs": "$12,000"
    }
  ],

  "lamar_alexander": [
    {
      "contributor": "International Paper",
      "total": "$48,950",
      "indivs": "$38,950",
      "pacs": "$10,000"
    },
    {
      "contributor": "Blue Cross/Blue Shield",
      "total": "$41,500",
      "indivs": "$21,500",
      "pacs": "$20,000"
    },
    {
      "contributor": "Hercules Holding",
      "total": "$38,600",
      "indivs": "$28,600",
      "pacs": "$10,000"
    },
    {
      "contributor": "Community Health Systems",
      "total": "$28,850",
      "indivs": "$23,850",
      "pacs": "$5,000"
    },
    {
      "contributor": "Comcast Corp",
      "total": "$27,300",
      "indivs": "$17,300",
      "pacs": "$10,000"
    }
  ],
  "max_baucus": [
    {
      "contributor": "Express Scripts",
      "total": "$45,918",
      "indivs": "$34,418",
      "pacs": "$11,500"
    },
    {
      "contributor": "Wells Fargo",
      "total": "$31,700",
      "indivs": "$26,700",
      "pacs": "$5,000"
    },
    {
      "contributor": "New York Life Insurance",
      "total": "$30,050",
      "indivs": "$25,050",
      "pacs": "$5,000"
    },
    {
      "contributor": "Fresenius Medical Care",
      "total": "$28,750",
      "indivs": "$17,750",
      "pacs": "$11,000"
    },
    {
      "contributor": "Welsh, Carson et al",
      "total": "$27,500",
      "indivs": "$25,000",
      "pacs": "$2,500"
    }
  ],
  "barbara_boxer": [
   {
     "contributor": "EMILY's List",
     "total": "$369,377",
     "indivs": "$363,348",
     "pacs": "$6,029"
   },
   {
     "contributor": "University of California",
     "total": "$145,690",
     "indivs": "$145,690",
     "pacs": "$0"
   },
   {
     "contributor": "21st Century Fox",
     "total": "$70,200",
     "indivs": "$67,700",
     "pacs": "$2,500"
   },
   {
     "contributor": "League of Conservation Voters",
     "total": "$68,768",
     "indivs": "$61,660",
     "pacs": "$7,108"
   },
   {
     "contributor": "Cotchett, Pitre & McCarthy",
     "total": "$48,650",
     "indivs": "$48,650",
     "pacs": "$0"
   }
 ],
 "maria_cantwell": [
    {
      "contributor": "Microsoft Corp",
      "total": "$108,474",
      "indivs": "$108,474",
      "pacs": "$0"
    },
    {
      "contributor": "EMILY's List",
      "total": "$81,450",
      "indivs": "$81,450",
      "pacs": "$0"
    },
    {
      "contributor": "League of Conservation Voters",
      "total": "$43,950",
      "indivs": "$43,950",
      "pacs": "$0"
    },
    {
      "contributor": "University of Washington",
      "total": "$43,237",
      "indivs": "$43,237",
      "pacs": "$0"
    },
    {
      "contributor": "Morgan & Morgan",
      "total": "$40,200",
      "indivs": "$40,200",
      "pacs": "$0"
    }
  ],
  "saxby_chambliss": [
    {
      "contributor": "Aetna Inc",
      "total": "$28,000",
      "indivs": "$23,000",
      "pacs": "$5,000"
    },
    {
      "contributor": "Primerica Inc",
      "total": "$20,000",
      "indivs": "$20,000",
      "pacs": "$0"
    },
    {
      "contributor": "CME Group",
      "total": "$17,300",
      "indivs": "$2,300",
      "pacs": "$15,000"
    },
    {
      "contributor": "King & Spalding",
      "total": "$16,950",
      "indivs": "$14,950",
      "pacs": "$2,000"
    },
    {
      "contributor": "Lasseter Tractor",
      "total": "$16,000",
      "indivs": "$16,000",
      "pacs": "$0"
    }
  ],
  "thad_cochran": [
   {
     "contributor": "General Atomics",
     "total": "$60,700",
     "indivs": "$45,700",
     "pacs": "$15,000"
   },
   {
     "contributor": "Telapex Inc",
     "total": "$59,100",
     "indivs": "$46,300",
     "pacs": "$12,800"
   },
   {
     "contributor": "Boeing Co",
     "total": "$44,300",
     "indivs": "$29,300",
     "pacs": "$15,000"
   },
   {
     "contributor": "Votesane PAC",
     "total": "$42,000",
     "indivs": "$42,000",
     "pacs": "$0"
   },
   {
     "contributor": "Tenax Aerospace",
     "total": "$41,500",
     "indivs": "$41,500",
     "pacs": "$0"
   }
 ],
 "susan_collins": [
    {
      "contributors": "General Dynamics",
      "total": "$60,850",
      "indivs": "$50,850",
      "pacs": "$10,000"
    },
    {
      "contributors": "DLA Piper",
      "total": "$54,133",
      "indivs": "$47,133",
      "pacs": "$7,000"
    },
    {
      "contributors": "Elliott Management",
      "total": "$48,050",
      "indivs": "$48,050",
      "pacs": "$0"
    },
    {
      "contributors": "Cohen Group",
      "total": "$33,726",
      "indivs": "$33,726",
      "pacs": "$0"
    },
    {
      "contributors": "Lions Gate Entertainment",
      "total": "$24,850",
      "indivs": "$24,850",
      "pacs": "$0"
    }
  ],
  "john_cornyn": [
    {
      "contributors": "Votesane PAC",
      "total": "$63,250",
      "indivs": "$63,250",
      "pacs": "$0"
    },
    {
      "contributors": "Exxon Mobil",
      "total": "$56,900",
      "indivs": "$46,900",
      "pacs": "$10,000"
    },
    {
      "contributors": "AT&T Inc",
      "total": "$56,800",
      "indivs": "$46,800",
      "pacs": "$10,000"
    },
    {
      "contributors": "Valero Energy",
      "total": "$54,750",
      "indivs": "$44,750",
      "pacs": "$10,000"
    },
    {
      "contributors": "Blackstone Group",
      "total": "$49,500",
      "indivs": "$41,000",
      "pacs": "$8,500"
    }
  ],
  "richard_durbin": [
    {
      "contributors": "Simmons Law Firm",
      "total": "$133,800",
      "indivs": "$133,800",
      "pacs": "$0"
    },
    {
      "contributors": "Jenner & Block",
      "total": "$68,255",
      "indivs": "$68,255",
      "pacs": "$0"
    },
    {
      "contributors": "Cooney & Conway",
      "total": "$64,000",
      "indivs": "$64,000",
      "pacs": "$0"
    },
    {
      "contributors": "Northrop Grumman",
      "total": "$64,000",
      "indivs": "$54,000",
      "pacs": "$10,000"
    },
    {
      "contributors": "MacAndrews & Forbes",
      "total": "$54,850",
      "indivs": "$44,850",
      "pacs": "$10,000"
    }
  ]
}

$.getJSON('https://www.govtrack.us/api/v2/role?current=true&format=json&fields=title_long,person__firstname,person__lastname&limit=6000', function(data) {
  // congress.push(data);
  //
  // delete data['meta'];
  // senators = data;

  // console.log(senators)
  // var senators = congress.filter(function(obj){
  //   return obj.objects.forEach(function(person){
  //     if(person.title_long === "Senator"){
  //       // console.log(person);
  //       senArray.push(person);
  //     }
  //   });
  // });
  // console.log(senArray);
});

senators = []
nodes = [];
links =[];



$.getJSON('https://www.govtrack.us/api/v2/vote_voter?vote=113155', function(data) {
  senators = data;
  // delete senators['meta'];

  console.log("getJSON")
  console.log(data);

  typeof(senators);

  senators.objects.forEach(function(senator){
    // console.log(senator);
    senator.thump = {
      // name: senator.person.name,
      name: senator.person.firstname.toLowerCase() +"_"+ senator.person.lastname.toLowerCase(),
      description: senator.person_role.description,
      party: senator.person_role.party,
      vote: senator.option.value,
      phone: senator.person_role.phone,
      gender: senator.person.gender_label,
      birthday: senator.person.birthday
    }
  });

  json_string = ""
  for(i=0; i<senators.objects.length; i++){
    var thumpr = senators.objects[i].thump;
    if(i == 0){
      json_string = json_string + JSON.stringify(thumpr, null, 2);
    } else {
      json_string = json_string + "," + JSON.stringify(thumpr, null, 2);
    }

  }

  var yays = [], nays = [];

  senators.objects.forEach(function(senator){
    if(senator.thump.vote === "Yea"){
      yays.push(senator)
    } else if (senator.thump.vote === "Nay") {
      nays.push(senator)
    }
  });
  console.log("Yays : " + yays.length, "Nays : " + nays.length);

  console.log("senators:")
  console.log(senators);

  var contributorNodes = [];
  var senatorNodes = [];
  var preLinks = [];
  var i = 0;
  for(senator in contributors) {
    // var vote = _.find(senators, function(s){ return s.})
    var sen = {name:senator};
    senatorNodes.push(sen);

    contributors[senator].forEach(function(e){
      var node_index = _.find(contributorNodes, function(node){ return node.name == e.contributors});
      if(! node_index){
        var obj = e;
        if(obj.contributors)
          obj.name = obj.contributors;
        else
          obj.name = obj.contributor;

        contributorNodes.push(obj);
      }
      else{
        var obj = node_index;
      }

      var value = parseInt(e.total.replace(',','').replace('$', ''));
      value = value / 1000.0;
      preLinks.push({source:obj, target:sen, value:value});

    });

  }

  console.log("preLinks");
  console.log(preLinks)

  nodes = contributorNodes.concat(senatorNodes);

  for (prelink in preLinks){

    //FUCK

    var sourceIndex = -1;
    var targetIndex = -1;
    for(var i = 0; i < nodes.length; ++i){
      if( preLinks[prelink].source.name == nodes[i].name) sourceIndex = i;
      if( preLinks[prelink].target.name == nodes[i].name) targetIndex = i;
    }
    // var sourceIndex = _.findIndex(nodes, function(node){ return node.name == prelink.source.name});
    // var targetIndex = _.findIndex(nodes, function(node){ return node.name == prelink.target.name});
    links.push({source:sourceIndex, target:targetIndex, value:preLinks[prelink].value});
  }
});


console.log("bloop")
console.log(nodes);
console.log(links);
console.log(senators);
